/* angular-invocation-handler - Version 0.1.2-dev, 05-08-2015
 * 
 * Enables general error handling and logging which allows to log errors, e.g for automatically sending back to the backend or for showing to the user
 * 
 * Copyright 2015  - Martin Reinhardt <contact@martinreinhardt-online.de>
 * License MIT
 */
var core=angular.module("ngIH.core",[]),ui=angular.module("ngIH.ui",[]);core.constant("httpErrors",{0:"Der Server ist nicht erreichbar..",404:"Dieser Dienst existiert nicht.",405:"Zugriffsfehler.",500:"Unbekannte Serverfehler."}),core.constant("ngIHConfig",{model:{alerts:"alerts"},customErrorHandler:!1,templateUrl:"holi-error-handler-ui/error-handler-config.ng.html",template:'<alert ng-repeat="alert in alerts" type="{{alert.type}}" close="alerts.splice($index, 1)">{{::alert.msg}}</alert>',feedbackAttach:!1}),core.provider("ngIHService",function(){"use strict";function a(a,b,c){return angular.extend(function(){var d=a.get("ngIHService");return d.call(c,b,arguments)},c)}var b=["$delegate","$injector",function(b,c){for(var d in b)angular.isFunction(b[d])&&(b[d]=a(c,b,b[d]));return b}];return{decorate:function(a,c){angular.forEach(c,function(c){a.decorator(c,b)})},$get:["$log","$injector","feedbackUI","ngIHConfig","httpErrors",function(a,b,c,d,e){var f={errors:[],resolveErrorCode:function(c,f,g){if(f){var h={error:f,timestamp:new Date,browserInfo:{navigatorAppName:navigator.appName,navigatorUserAgent:navigator.userAgent,navigatorPlatform:navigator.platform}};d.customErrorHandler?b.get(d.customErrorHandler).resolve(h,g):(f&&!angular.isUndefined(f.status)?f=e[f.status]:f&&f.message&&(f=f.message),angular.isString(f)||(f="An unkown error occurred."),c&&c.description&&(f="Call to "+c.description+" had caused errors."),a.error("An error occurred: "+f),g(h))}},funcError:function(a,b){f.resolveErrorCode(a,b,function(a){d.feedbackAttach&&c.appendErrorMsg(a),f.errors.push(a)})},call:function(b,c,d){a.debug("Function called: ",b.name||b);var e;try{e=b.apply(c,d)}catch(g){throw f.funcError(b,g),g}var h=e&&e.$promise||e;return h&&angular.isFunction(h.then)&&angular.isFunction(h["catch"])&&f.async(b,h),e},async:function(a,b){return b["catch"](function(b){f.funcError(a,b)}),b}};return f}]}}),core.factory("httpErrorInterceptor",function(){"use strict";return{request:function(a){return a.timeout=3e3,a}}}),core.config(["$provide","$httpProvider",function(a,b){"use strict";b.interceptors.push("httpErrorInterceptor"),a.decorator("$exceptionHandler",["$delegate",function(a){return function(b,c){a(b,c)}}])}]),ui.factory("feedbackUI",["ngIHConfig","$timeout","$rootScope",function(a,b,c){"use strict";return{appendErrorMsg:function(b){c[a.model.alerts]||(c[a.model.alerts]=[]),c[a.model.alerts].push({type:"danger",msg:b})},appendInfoMsg:function(b){c[a.model.alerts]||(c[a.model.alerts]=[]),c[a.model.alerts].push({type:"info",msg:b})}}}]),ui.directive("uiErrorHandler",["$rootScope","ngIHConfig",function(a,b){"use strict";return{restrict:"A",compile:function(a){a.append(b.template)}}}]),ui.run(["$rootScope","$document","ngIHConfig","$templateCache",function(a,b,c,d){"use strict";a.$on("$routeChangeStart",function(){a[c.model.alerts]=[]}),b.find(".header").attr("ui-error-handler",""),c.template&&(c.templateUrl="$$angular-errorhandler-template$$",d.put(c.templateUrl,c.template))}]);